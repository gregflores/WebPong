<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>WEB PONG</h1>
    <canvas id="gameCanvas" width="800" height="600"></canvas>>
</body>

<script>
    let canvas;
    let canvasContext;
    const ballRadius = 20;
    const paddleHeight = 100;
    const paddleWidth = 20;
    const goalPadding = 20
    const player1X = goalPadding;
    const player2X = 800 - goalPadding - paddleWidth;

    let ballX = 50;
    let ballY = 50;
    let velocityX = 5;
    let velocityY = 5;

    let player1Y = 100;
    let player2Y = 100;
    let player2Speed = 10;

    function calculateMousePos(evt) {
        let rect = canvas.getBoundingClientRect();
        let root = document.documentElement;
        let mouseX = evt.clientX - rect.left - root.scrollLeft;
        let mouseY = evt.clientY - rect.top - root.scrollTop;
        return {
            x:mouseX,
            y:mouseY
        };
    }
    

    window.onload = function() {
        console.log("hello world");
        canvas = document.getElementById('gameCanvas');
        canvasContext = canvas.getContext('2d');
        const FPS = 60;
        setInterval(() => {moveEverything(),drawEverything();}, 1000/FPS);

        // Handle player movement with mouse
        canvas.addEventListener('mousemove',
            function(evt) {
                let mousePos = calculateMousePos(evt);
                player1Y = mousePos.y - (paddleHeight/2);
            }
        )
    }

    function ballReset() {
        velocityX = -velocityX;
        velocityY = -velocityY;
        ballX = canvas.width / 2;
        ballX = canvas.height / 2;
    }

    function enemyAi() {
        let verticalDistance = player2Y + (paddleHeight/2) - ballY;
        console.log(verticalDistance/Math.abs(verticalDistance))
        player2Y += (Math.sign(verticalDistance) * -player2Speed);
    }


    // Movement updating function
    function moveEverything() {
        // Handle X axis movement and collision
        if(ballX + ballRadius > player2X) {
            if(ballY > player2Y && ballY < player2Y + paddleHeight) {
                velocityX = -velocityX;
            } else ballReset();
        } else if (ballX - ballRadius < player1X + paddleWidth - 1) {
            if(ballY > player1Y && ballY < player1Y + paddleHeight) {
                velocityX = -velocityX;
            } else ballReset();
        }
        // Handle Y axis movement and collision
        if(ballY + ballRadius > canvas.height) {
            velocityY = -velocityY;
        } else if (ballY - ballRadius < 0) {
            
            velocityY = -velocityY;
        }
        enemyAi();
        ballX += velocityX;
        ballY += velocityY;
    }

    function drawCanvas() {
        colorRect(0,0,canvas.width,canvas.height,'black');
    }

    // Function for drawing any rectangle given parameters
    function colorRect(leftX, topY, width, height, drawColor) {
        canvasContext.fillStyle = drawColor;
        canvasContext.fillRect(leftX,topY,width,height);
    }

    // Function for drawing any circle given parameters
    function colorCircle(centerX, centerY, radius, drawColor) {
        canvasContext.fillStyle = drawColor;
        canvasContext.beginPath();
        canvasContext.arc(centerX, centerY, radius, 0, 2*Math.PI, true);
        canvasContext.fill();
    }

    // Function for drawing the screen every frame
    function drawEverything() {
        drawCanvas();
        colorRect(player1X, player1Y, paddleWidth, paddleHeight, 'red');
        colorRect(player2X, player2Y, paddleWidth, paddleHeight, 'green');

        colorCircle(ballX, ballY, ballRadius, 'blue')
    }
</script>
</html>